{% extends "base.html" %}

{% block title %}Generate Blog - AI Research Blog{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="fas fa-magic me-3"></i>Generate AI Blog Post
                </h1>
                <p class="lead text-muted">
                    Automatically generate a blog post from the latest AI research papers on arXiv
                </p>
            </div>
            
            <div class="card shadow">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-robot fa-4x text-primary mb-3"></i>
                        <h4>How it works</h4>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4 text-center mb-3">
                            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                                 style="width: 60px; height: 60px;">
                                <i class="fas fa-download text-primary"></i>
                            </div>
                            <h6>1. Fetch Papers</h6>
                            <small class="text-muted">Retrieve latest AI research from arXiv</small>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                                 style="width: 60px; height: 60px;">
                                <i class="fas fa-brain text-primary"></i>
                            </div>
                            <h6>2. AI Processing</h6>
                            <small class="text-muted">Generate content using Groq AI</small>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                                 style="width: 60px; height: 60px;">
                                <i class="fas fa-file-alt text-primary"></i>
                            </div>
                            <h6>3. Create Blog</h6>
                            <small class="text-muted">Format and save the blog post</small>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> This process may take 30-60 seconds to complete as we fetch the latest research papers and generate high-quality content.
                    </div>
                    
                    <form method="POST" id="generateForm">
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg" id="generateBtn">
                                <i class="fas fa-magic me-2"></i>Generate Blog Post
                            </button>
                        </div>
                    </form>
                    
                    <div id="loadingDiv" class="text-center mt-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">
                            <span id="loadingText">Fetching latest AI research papers...</span>
                        </p>
                        <div class="progress mt-3">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%" id="progressBar"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-question-circle me-2"></i>Frequently Asked Questions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="faqAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq1">
                                        What type of papers are included?
                                    </button>
                                </h2>
                                <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        We focus on AI, Machine Learning, and Computer Science papers from arXiv, 
                                        specifically categories like cs.AI, cs.LG, and cs.CL.
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq2">
                                        How often should I generate new posts?
                                    </button>
                                </h2>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        We recommend generating new posts daily or weekly to stay current with 
                                        the latest research developments.
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq3">
                                        Can I customize the content?
                                    </button>
                                </h2>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        The generated content is automatically formatted, but you can always create 
                                        manual blog posts for full customization control.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('generateForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const generateBtn = document.getElementById('generateBtn');
    const loadingDiv = document.getElementById('loadingDiv');
    const loadingText = document.getElementById('loadingText');
    const progressBar = document.getElementById('progressBar');
    
    // Show loading state
    generateBtn.disabled = true;
    generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
    loadingDiv.style.display = 'block';
    
    // Simulate progress updates
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + '%';
        
        if (progress < 30) {
            loadingText.textContent = 'Fetching latest AI research papers...';
        } else if (progress < 60) {
            loadingText.textContent = 'Processing papers with AI...';
        } else {
            loadingText.textContent = 'Generating blog content...';
        }
    }, 1000);
    
    // Submit the form
    fetch(window.location.href, {
        method: 'POST',
        body: new FormData(this)
    })
    .then(response => {
        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        loadingText.textContent = 'Complete!';
        
        if (response.redirected) {
            window.location.href = response.url;
        } else {
            return response.text();
        }
    })
    .then(html => {
        if (html) {
            document.documentElement.innerHTML = html;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        clearInterval(progressInterval);
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Generate Blog Post';
        loadingDiv.style.display = 'none';
        
        // Show error message
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger mt-3';
        alertDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>An error occurred. Please try again.';
        document.querySelector('.card-body').appendChild(alertDiv);
    });
});
</script>
{% endblock %}
